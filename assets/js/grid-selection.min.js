(function($){const STORAGE_KEY_PREFIX="admin_grid_selection_";function getModelClass(){const urlParams=new URLSearchParams(window.location.search);let modelClass=urlParams.get("model_class");if(!modelClass){const $box=$(".wg-box");if($box.length){modelClass=$box.data("model-class")}}return modelClass}function getStorageKey(){const modelClass=getModelClass();if(!modelClass)return null;return STORAGE_KEY_PREFIX+modelClass}function getSelection(){const key=getStorageKey();if(!key)return[];const stored=sessionStorage.getItem(key);try{return stored?JSON.parse(stored):[]}catch(e){return[]}}function saveSelection(ids){const key=getStorageKey();if(key){sessionStorage.setItem(key,JSON.stringify(ids))}}function clearSelection(){const key=getStorageKey();if(key)sessionStorage.removeItem(key)}function checkReferrer(){const key=getStorageKey();if(!key)return;const referrer=document.referrer;let shouldClear=true;try{if(referrer){const refUrl=new URL(referrer);if(refUrl.origin===window.location.origin){const refParams=new URLSearchParams(refUrl.search);let refModelClass=refParams.get("model_class");if(refUrl.pathname===window.location.pathname){shouldClear=false}else if(refModelClass){const currentModelClass=getStorageKey().replace(STORAGE_KEY_PREFIX,"");if(refModelClass===currentModelClass){shouldClear=false}}}}else{shouldClear=true}}catch(e){shouldClear=true}if(shouldClear){clearSelection()}}function updateState(){const ids=getSelection();$('input[name="selection[]"]').each(function(){if(ids.includes($(this).val())){$(this).prop("checked",true)}else{$(this).prop("checked",false)}});const $btn=$(".js-batch-delete-btn");if(ids.length>0){$btn.removeClass("d-none")}else{$btn.addClass("d-none")}}$(document).ready(function(){if(!getStorageKey())return;checkReferrer();updateState();$(document).on("change",'input[name="selection[]"]',function(){let ids=getSelection();const val=$(this).val();if($(this).is(":checked")){if(!ids.includes(val))ids.push(val)}else{ids=ids.filter(id=>id!==val)}saveSelection(ids);updateState()});$(document).on("change",".select-on-check-all",function(){setTimeout(()=>{let ids=getSelection();const isChecked=$(this).is(":checked");$('input[name="selection[]"]').each(function(){const val=$(this).val();if(isChecked){if(!ids.includes(val))ids.push(val)}else{ids=ids.filter(id=>id!==val)}});saveSelection(ids);updateState()},50)});$(document).on("click",".js-batch-delete-btn",function(e){e.preventDefault();const ids=getSelection();if(ids.length===0)return;$("#batchDeleteModal .modal-body").text(ids.join(", "));const modalEl=document.getElementById("batchDeleteModal");const modal=new bootstrap.Modal(modalEl);modal.show()});$(document).on("click",".js-confirm-batch-delete",function(){const ids=getSelection();const modelClass=getModelClass();if(!modelClass||ids.length===0)return;const $form=$("<form>",{method:"POST",action:"batch-delete?model_class="+encodeURIComponent(modelClass)});const csrfParam=$('meta[name="csrf-param"]').attr("content");const csrfToken=$('meta[name="csrf-token"]').attr("content");if(csrfParam){$form.append($("<input>",{type:"hidden",name:csrfParam,value:csrfToken}))}ids.forEach(id=>{$form.append($("<input>",{type:"hidden",name:"ids[]",value:id}))});$("body").append($form);$form.submit();clearSelection()});$(document).on("pjax:end",function(){updateState()})})})(jQuery);