document.addEventListener("DOMContentLoaded",function(){if(document.querySelector(".js-get-api-key")&&document.querySelector(".js-get-api-key").length>0){document.querySelector(".js-get-api-key").addEventListener("click",async function(event){event.preventDefault();const domain=window.location.hostname;const csrfToken=document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{const response=await fetch("https://api.keypage.ru/mitisk/api/get.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain})});const data=await response.json();if(!data.api_key){alert("Ошибка: не удалось получить API ключ");return}const saveResponse=await fetch("/admin/settings/save-api/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":csrfToken},body:JSON.stringify({api_key:data.api_key})});const saveResult=await saveResponse.json();if(saveResult.success){$(".js-success").removeClass("hidden");$(".js-error-api").addClass("hidden")}else{alert("Ошибка при сохранении API ключа")}}catch(e){alert("Ошибка запроса или сохранения API ключа")}})}var maxEmails=5;var emailSelector=".js-add-email";function updateButtons(){var fields=$(emailSelector);var count=fields.length;fields.each(function(index){var addBtn=$(this).find(".js-add-more");var removeBtn=$(this).find(".remove-email");if(count>=maxEmails){addBtn.hide();removeBtn.show()}else{if(index===count-1){addBtn.show();removeBtn.hide()}else{addBtn.hide();removeBtn.show()}}})}$(document).on("click",".js-add-more",function(e){e.preventDefault();var count=$(emailSelector).length;if(count>=maxEmails)return;var lastField=$(emailSelector).last();var newField=lastField.clone();newField.find('input[type="email"]').val("");lastField.after(newField);updateButtons()});$(document).on("click",".remove-email",function(e){e.preventDefault();if($(emailSelector).length>1){$(this).closest(emailSelector).remove();updateButtons()}});updateButtons();var select=document.getElementById("timezone-select");if(select){var timezones=moment.tz.names();timezones.forEach(function(zone){var option=document.createElement("option");option.value=zone;option.textContent=zone;select.appendChild(option)});if(selectedTimezone&&timezones.includes(selectedTimezone)){select.value=selectedTimezone}else{var guessed=moment.tz.guess();if(guessed&&timezones.includes(guessed)){select.value=guessed}}}$(document).on("click",".js-copy-settings",function(){var $el=$(this);var text=$el.data("copy");if(navigator.clipboard){navigator.clipboard.writeText(text)}else{var temp=$("<input>");$("body").append(temp);temp.val(text).select();document.execCommand("copy");temp.remove()}$el.removeClass("icon-copy").addClass("icon-check");setTimeout(function(){$el.removeClass("icon-check").addClass("icon-copy")},1500)})});