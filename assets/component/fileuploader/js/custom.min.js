$(document).ready(function(){let fileUploaderCounter=1;var commonOptions={extensions:null,captions:"ru",changeInput:" ",theme:"thumbnails",enableApi:true,removeConfirmation:false,thumbnails:{box:'<div class="fileuploader-items">'+'<ul class="fileuploader-items-list">'+'<li class="fileuploader-thumbnails-input"><div class="fileuploader-thumbnails-input-inner"><i>+</i></div></li>'+"</ul>"+"</div>",item:'<li class="fileuploader-item">'+'<div class="fileuploader-item-inner">'+'<div class="type-holder">${extension}</div>'+'<div class="actions-holder">'+'<button type="button" class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i class="fileuploader-icon-remove"></i></button>'+"</div>"+'<div class="thumbnail-holder">'+"${image}"+'<span class="fileuploader-action-popup"></span>'+"</div>"+'<div class="content-holder"><h5 title="${name}">${name}</h5>'+'<input type="hidden" class="js-temp-name" name="FileUploader[temp][${data.field_name}][${data.file_id}][id]" value="${data.file_id}">'+'<input type="text" class="alt-fileuploader-input js-temp-alt-name" name="FileUploader[temp][${data.field_name}][${data.file_id}][alt]" value="${data.alt}" maxlength="225" placeholder="Alt" autocomplete="off">'+"<span>${size2}</span></div>"+'<div class="progress-holder">${progressBar}</div>'+"</div>"+"</li>",item2:'<li class="fileuploader-item">'+'<div class="fileuploader-item-inner">'+'<div class="type-holder">${extension}</div>'+'<div class="actions-holder">'+'<a href="${file}" class="fileuploader-action fileuploader-action-download" title="${captions.download}" download><i class="fileuploader-icon-download"></i></a>'+'<button type="button" class="fileuploader-action fileuploader-action-remove" title="${captions.remove}"><i class="fileuploader-icon-remove"></i></button>'+"</div>"+'<div class="thumbnail-holder">'+"${image}"+'<span class="fileuploader-action-popup"></span>'+"</div>"+'<div class="content-holder"><h5 title="${name}">${name}</h5>'+'<input type="hidden" name="FileUploader[${data.field_name}][${data.file_id}][id]" value="${data.file_id}">'+'<input type="text" class="alt-fileuploader-input" name="FileUploader[${data.field_name}][${data.file_id}][alt]" value="${data.alt}" maxlength="225" placeholder="Alt" autocomplete="off">'+"<span>${size2}</span></div>"+'<div class="progress-holder">${progressBar}</div>'+"</div>"+"</li>",startImageRenderer:true,canvasImage:false,_selectors:{list:".fileuploader-items-list",item:".fileuploader-item",start:".fileuploader-action-start",retry:".fileuploader-action-retry",remove:".fileuploader-action-remove"},onItemShow:function(item,listEl,parentEl,newInputEl,inputEl){var plusInput=listEl.find(".fileuploader-thumbnails-input"),api=$.fileuploader.getInstance(inputEl.get(0));plusInput.insertAfter(item.html)[api.getOptions().limit&&api.getFiles().length>=api.getOptions().limit?"hide":"show"]();if(item.format=="image"){item.html.find(".fileuploader-item-icon").hide()}var withoutAlt=$(inputEl).hasClass("fileuploader-without-alt");if(withoutAlt){item.html.find(".alt-fileuploader-input, .js-temp-alt-name").remove()}if(!item.data.field_name){const nameAttribute=extractFieldName(inputEl.attr("name"));const tempNameInput=item.html.find(".js-temp-name");const tempAltNameInput=item.html.find(".js-temp-alt-name");function updateInputName(input,newNameTemplate,counter){if(input.length){const newName=newNameTemplate.replace("[]",`[${counter}]`);input.attr("name",newName)}}updateInputName(tempNameInput,`FileUploader[temp][${nameAttribute}][][id]`,fileUploaderCounter);if(!withoutAlt){updateInputName(tempAltNameInput,`FileUploader[temp][${nameAttribute}][][alt]`,fileUploaderCounter)}fileUploaderCounter++}},onItemRemove:function(html,listEl,parentEl,newInputEl,inputEl){var plusInput=listEl.find(".fileuploader-thumbnails-input"),api=$.fileuploader.getInstance(inputEl.get(0));html.children().animate({opacity:0},200,function(){html.remove();if(api.getOptions().limit&&api.getFiles().length-1<api.getOptions().limit)plusInput.show()})}},dragDrop:{container:".fileuploader-thumbnails-input"},afterRender:function(listEl,parentEl,newInputEl,inputEl){var plusInput=listEl.find(".fileuploader-thumbnails-input"),api=$.fileuploader.getInstance(inputEl.get(0));plusInput.on("click",function(){api.open()});api.getOptions().dragDrop.container=plusInput}};function extractFieldName(name){const match=name.match(/\[(.*?)\]/);return match?match[1]:null}$(".fileuploader-multiple").fileuploader($.extend({},commonOptions,{addMore:true,limit:12}));$(".fileuploader-single").each(function(){var $input=$(this);var options=$.extend(true,{},commonOptions,{addMore:false,limit:1});var cropWidth=$input.data("crop-width");var cropHeight=$input.data("crop-height");if(cropWidth&&cropHeight){var itemTemplate=options.thumbnails.item;if(itemTemplate.indexOf("fileuploader-action-popup")===-1){options.thumbnails.item=itemTemplate.replace('<div class="thumbnail-holder">','<div class="thumbnail-holder"><span class="fileuploader-action-popup" data-action="fileuploader-edit"></span>')}options.editor={maxWidth:2e3,maxHeight:2e3,quality:98,cropper:{showGrid:true,ratio:cropWidth+":"+cropHeight,minWidth:cropWidth,minHeight:cropHeight},onSave:function(base64,item,listEl,parentEl,newInputEl,inputEl){var api=$.fileuploader.getInstance(inputEl);item.editor._blob=api.assets.dataURItoBlob(base64,item.type);if(window.DataTransfer&&item.editor._blob){try{var file=new File([item.editor._blob],item.name,{type:item.type});var dataTransfer=new DataTransfer;dataTransfer.items.add(file);inputEl[0].files=dataTransfer.files}catch(e){console.error("Could not update file input",e)}}if(item.popup.close)item.popup.close();item.renderThumbnail()}};options.thumbnails.popup={onShow:function(item){item.popup.html.on("click",'[data-action="save"]',function(e){if(item.editor)item.editor.save()}).on("click",'[data-action="cancel"]',function(e){item.popup.close()});if(item.editor)item.editor.cropper()},onHide:function(item){if(!item.isSaving&&!item.uploaded&&!item.appended){}}};options.onImageLoaded=function(item){if(item.choosed&&!item.isSaving){if(item.reader.node&&(item.reader.width>=cropWidth&&item.reader.height>=cropHeight)){item.image.hide();setTimeout(function(){if(item.popup){item.popup.open();item.editor.cropper()}},100)}else{item.remove();alert("Изображение слишком маленькое! Минимальный размер: "+cropWidth+"x"+cropHeight)}}}}$input.fileuploader(options)})});