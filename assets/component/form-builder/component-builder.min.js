(function(w,d,$){"use strict";$(function(){const $draggable=$(".list-draggable-container");if($draggable.length&&typeof $draggable.arrangeable==="function"){$draggable.arrangeable({dragSelector:".drag-area"})}const fbNode=d.getElementById("build-wrap");let formBuilder=null;const cssEscape=val=>String(val).replace(/["\\]]/g,"\\$&");const $dataInput=$("#adminmodel-data");const syncFieldsState=()=>{if(!formBuilder)return;const raw=formBuilder.formData;if(raw===false)return;$dataInput.val(raw);if(!raw||raw.length===0)return;let parsed;try{parsed=JSON.parse(raw)}catch(e){console.error("Invalid formData JSON",e);return}const $toggles=$(".js-click-to-attr");$toggles.prop("checked",false).prop("disabled",false);parsed.forEach(item=>{if(item&&item.name){const selector=`.js-click-to-attr[data-name="${cssEscape(item.name)}"]`;const $el=$(selector);if($el.length){$el.prop("checked",true).prop("disabled",true)}}})};if(fbNode&&$.fn.formBuilder){formBuilder=$(fbNode).formBuilder({i18n:{locale:"ru-RU",location:"/web/lang/"},formData:Array.isArray(w.formData)||typeof w.formData==="object"?JSON.stringify(w.formData):w.formData||"[]",actionButtons:[],allowStageSort:true,append:false,prepend:false,controlOrder:["text","textarea","select","checkbox-group","checkbox","date","file","hidden","number","header","paragraph","hrLine"],controlPosition:"right",dataType:"json",defaultFields:[],disabledActionButtons:["save","data","clear"],disabledAttrs:[],disabledFieldButtons:{hrLine:["edit"]},disabledSubtypes:{},disableFields:["autocomplete","button","radio-group"],disableHTMLLabels:false,disableInjectedStyle:false,editOnAdd:false,fields:[{label:"Разделитель",attrs:{type:"hrLine"},icon:" — "}],fieldRemoveWarn:false,fieldEditContainer:null,inputSets:[],notify:{error:console.error,success:console.log,warning:console.warn},persistDefaultFields:false,onAddField:function(){syncFieldsState()},onAddOption:()=>null,onClearAll:function(){syncFieldsState()},onCloseFieldEdit:function(){syncFieldsState()},onOpenFieldEdit:()=>null,onSave:function(evt,formData){$dataInput.val(formData)},replaceFields:[],roles:w.roles||{},scrollToFieldOnAdd:true,showActionButtons:true,sortableControls:false,stickyControls:{enable:true,offset:{top:5,bottom:"auto",right:"auto"}},subtypes:{},templates:{hrLine:function(){return{field:"<hr>"}}},typeUserAttrs:{text:{readonly:{label:"Readonly",value:false,type:"checkbox"}},number:{readonly:{label:"Readonly",value:false,type:"checkbox"}},"checkbox-group":{publicStaticMethod:{label:"Метод значений",options:w.publicStaticMethods||{}},publicSaveMethod:{label:"Метод для сохранения",options:w.publicSaveMethods||{}},readonly:{label:"Readonly",value:false,type:"checkbox"}},select:{publicStaticMethod:{label:"Метод значений",options:w.publicStaticMethods||{}},publicSaveMethod:{label:"Метод для сохранения",options:w.publicSaveMethods||{}},readonly:{label:"Readonly",value:false,type:"checkbox"}},date:{readonly:{label:"Readonly",value:false,type:"checkbox"}},file:{readonly:{label:"Readonly",value:false,type:"checkbox"}},textarea:{viewtype:{label:"Тип",options:{textarea:"Текстовое поле",visual:"Визуальный редактор",html:"HTML код"}},readonly:{label:"Readonly",value:false,type:"checkbox"}}},typeUserDisabledAttrs:{text:["value"],number:["value","subtype"],"checkbox-group":["toggle","inline","other"],date:["value","subtype","min","max","step"],file:["placeholder"],hrLine:["value"],textarea:["value","maxlength","rows","subtype"]},typeUserEvents:{},enableEnhancedBootstrapGrid:true});syncFieldsState()}$(d).on("click",".js-click-to-attr",function(e){if(!formBuilder)return;const $el=$(this);const field={type:$el.data("type"),className:"form-control",name:$el.data("name"),label:$el.data("label"),required:$el.data("required")===true||$el.data("required")==="true"};if(!$el.prop("disabled")){formBuilder.actions.addField(field)}$el.prop("disabled",true);syncFieldsState()});$(d).on("click",".js-list-actions",function(){const $el=$(this);$el.toggleClass("active");const $input=$el.find("input");if($input.length){const val=String($input.val())==="1"?"0":"1";$input.val(val)}});$(d).on("click",".js-check-to-save",function(e){e.preventDefault();syncFieldsState();$(this).closest("form").trigger("submit")})})})(window,document,jQuery);